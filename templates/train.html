<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Upload or Record Audio Files</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <style>
        body {
            margin: 0;
            padding: 10px;
            font-family: Arial, sans-serif;
        }
        .left-aligned-container {
            text-align: left;
            width: 100%;
            max-width: 500px;
            margin: 0 auto;
        }
        form label, form input, form select, form button, .record-controls button {
            margin: 5px 0;
            width: auto;
            padding: 8px;
            box-sizing: border-box;
        }
        form input[type="text"], form input[type="file"], form select, form input[type="submit"], .record-controls button {
            max-width: 100%;
        }
        @media (max-width: 599px) {
            .left-aligned-container {
                max-width: none;
            }
        }
    </style>
</head>
<body>
<header>
    <div class="navbar">
        <!-- Your navigation bar content -->
    </div>
</header>

<div class="left-aligned-container">
    <h2>Record Audio</h2>
    <label for="languageSelect">Choose Language:</label>
    <select id="languageSelect">
        <option value="English">English</option>
        <option value="Hindi">Hindi</option>
    </select><br><br>

    <label for="scriptText">Script:</label>
    <textarea id="scriptText" rows="10" cols="50" readonly></textarea><br><br>

    <div id="instructions">
        <strong>Instructions:</strong>
        <ol>
            <li>Choose language.</li>
            <li>Start recording and begin reading the script aloud.</li>
            <li>Click 'Stop Recording' when done.</li>
            <li>Play back your recording. If unsatisfied, click 'Cancel' to restart.</li>
            <li>Once satisfied, click 'Upload' and wait. Please do not click 'Upload' multiple times.</li>
        </ol>
    </div>

    <button id="startRecording">Start Recording</button>
    <button id="stopRecording" disabled>Stop Recording</button>
    <button id="cancelRecording" disabled>Cancel</button>
    <button id="upload" disabled>Upload</button>
    <audio id="audioPlayback" controls hidden></audio>
</div>

<div class="left-aligned-container">
    <a href="/get-jobs">Go to Job Tracking Page</a>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const scripts = {
            English: "Your English script goes here...",
            Hindi: "Your Hindi script goes here..."
        };

        document.getElementById("languageSelect").addEventListener("change", function() {
            const selectedLanguage = this.value;
            document.getElementById("scriptText").textContent = scripts[selectedLanguage];
        });

        document.getElementById("scriptText").textContent = scripts["English"];

        let mediaRecorder;
        let audioChunks = [];
        let audioBlob;

        document.getElementById("startRecording").addEventListener("click", function() {
            navigator.mediaDevices.getUserMedia({ audio: true })
                .then(stream => {
                    mediaRecorder = new MediaRecorder(stream);
                    mediaRecorder.ondataavailable = event => {
                        audioChunks.push(event.data);
                    };
                    mediaRecorder.onstop = () => {
                        audioBlob = new Blob(audioChunks, { type: 'audio/wav' });
                        const audioUrl = URL.createObjectURL(audioBlob);
                        document.getElementById("audioPlayback").src = audioUrl;
                        document.getElementById("audioPlayback").hidden = false;
                        document.getElementById("upload").disabled = false;
                        audioChunks = [];
                    };
                    mediaRecorder.start();
                    document.getElementById("startRecording").disabled = true;
                    document.getElementById("stopRecording").disabled = false;
                    document.getElementById("cancelRecording").disabled = false;
                });
        });

        document.getElementById("stopRecording").addEventListener("click", function() {
            mediaRecorder.stop();
            document.getElementById("startRecording").disabled = false;
            document.getElementById("stopRecording").disabled = true;
        });

        document.getElementById("cancelRecording").addEventListener("click", function() {
            document.getElementById("audioPlayback").hidden = true;
            document.getElementById("upload").disabled = true;
            document.getElementById("startRecording").disabled = false;
            document.getElementById("stopRecording").disabled = true;
            document.getElementById("cancelRecording").disabled = true;
            audioChunks = [];
        });

        document.getElementById("upload").onclick = function() {
            // Upload logic goes here
        };
    });
</script>
</body>
</html>
